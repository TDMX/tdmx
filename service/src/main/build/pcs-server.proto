// Copyright (c) 2015 Peter Klauser

option java_generic_services = true;
option java_package = "org.tdmx.server.pcs.protobuf";
option java_outer_classname = "PCSServer";

message AssociateApiSessionRequest {
	required SessionHandle handle = 1;
    required bytes pkixCertificate = 2;
}

message AssociateApiSessionResponse {
	optional string sessionId = 1;
	optional string httpsUrl = 2; 
    optional bytes serverCert = 3;
}

message AttributeValue {
	enum AttributeId {
	  AccountZoneId = 0;
	  ZoneId = 1;
	  DomainId = 2;
	  ChannelId = 3;
	  TemporaryChannelId = 4;
	  ServiceId = 5;
	  AddressId = 6;
	}
	required AttributeId name = 1;
	optional int64 value = 2;
}

message SessionHandle {
	optional string segment = 1;
	optional string apiName = 2;
	optional string sessionKey = 3;
	repeated AttributeValue attribute = 4;
}


message RegisterServerRequest {
	repeated ServiceHandle service = 1;
}

message RegisterServerResponse {
}


message ServiceHandle {
	optional string segment = 1;
	optional string apiName = 2;
	optional string httpsUrl = 3;
    optional bytes serverCert = 4;
}


message NotifySessionRemovedRequest {
	optional string apiName = 1;
	repeated string sessionId = 2;
}

message NotifySessionRemovedResponse {
}


message InvalidateCertificateRequest {
    optional bytes clientCert = 1;
}

message InvalidateCertificateResponse {
}



service ControlServiceProxy {
    rpc associateApiSession(AssociateApiSessionRequest) returns (AssociateApiSessionResponse);
    rpc registerServer(RegisterServerRequest) returns (RegisterServerResponse);
    rpc notifySessionsRemoved(NotifySessionRemovedRequest) returns (NotifySessionRemovedResponse);
    rpc invalidateCertificate(InvalidateCertificateRequest) returns (InvalidateCertificateResponse);
}

